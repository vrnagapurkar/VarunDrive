<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload File - VarunDrive</title>
</head>
<body>
<h1>Upload File</h1>

<button id="logoutBtn">Logout</button><br/><br/>

<input type="file" id="fileInput" /><br/>
<button id="uploadBtn">Upload</button>
<p><a href="dashboard.html">Go to Dashboard</a></p>

<script>
const API_BASE = "https://yn2y9x0yi5.execute-api.us-east-1.amazonaws.com/dev";
const idToken = localStorage.getItem('idToken');
const userId = localStorage.getItem('email');

if (!idToken || !userId) {
  alert('Not logged in');
  window.location.href = 'login.html';
}

// Logout
document.getElementById('logoutBtn').addEventListener('click', () => {
  localStorage.removeItem('idToken');
  localStorage.removeItem('email');
  window.location.href = 'login.html';
});

// Convert file to base64
async function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = error => reject(error);
  });
}

// Upload file
document.getElementById('uploadBtn').addEventListener('click', async () => {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return alert('Select a file');
  
  const fileContent = await toBase64(file);

  try {
    const res = await fetch(`${API_BASE}/upload`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${idToken}`
      },
      body: JSON.stringify({ userId, fileName: file.name, fileContent })
    });

    const data = await res.json();
    alert(data.message || data.error);
  } catch (err) {
    console.error(err);
    alert('Error uploading file');
  }
});
</script>
</body>
</html>
